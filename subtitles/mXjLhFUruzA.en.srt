1
00:00:04,049 --> 00:00:04,790
a lower-body

2
00:00:04,790 --> 00:00:08,160
welcome to the last session in the
automation

3
00:00:08,160 --> 00:00:11,440
ops team to track I'm

4
00:00:11,440 --> 00:00:14,790
very happy to introduce to you Peter
Baumgartner is gonna talk about salt

5
00:00:14,790 --> 00:00:16,160
salt stack

6
00:00:16,160 --> 00:00:23,160
and the way

7
00:00:26,120 --> 00:00:28,190
all right thank you thank everybody for
coming

8
00:00:28,190 --> 00:00:31,360
and so yeah this is getting started with
salt

9
00:00:31,360 --> 00:00:35,989
the like you said I'm Peter Baumgartner
ponder for a company called Lincoln

10
00:00:35,989 --> 00:00:36,380
whoop

11
00:00:36,380 --> 00:00:40,550
we do lots of web application
development and pipe and so we end up

12
00:00:40,550 --> 00:00:41,940
setting up a lot of servers

13
00:00:41,940 --> 00:00:47,120
to do that we use all the just to get a
idea who's here

14
00:00:47,120 --> 00:00:51,210
some how many people in our interviews
shopper puppet in the past

15
00:00:51,210 --> 00:00:54,460
for configuration management while ca
the

16
00:00:54,460 --> 00:00:57,620
fabric views fabric okay

17
00:00:57,620 --> 00:01:01,260
and is able to hear you salt okay

18
00:01:01,260 --> 00:01:04,330
the this is a a pretty introductory

19
00:01:04,330 --> 00:01:07,759
the talk so if you

20
00:01:07,759 --> 00:01:11,520
you saw quite a bit you may find a
boring or repetitive but

21
00:01:11,520 --> 00:01:16,420
yeah any thought dives in a an audience
okay good

22
00:01:16,420 --> 00:01:19,570
noted it on their own oh wait I see a
hand

23
00:01:19,570 --> 00:01:24,729
%uh now okay what I screwed something up
a minha okay so

24
00:01:24,729 --> 00:01:28,119
I let's get third one assault stack
South sac

25
00:01:28,119 --> 00:01:31,409
this is from their web sites all sector
livers a dynamic infrastructure

26
00:01:31,409 --> 00:01:32,479
communication bus

27
00:01:32,479 --> 00:01:37,729
use for orchestration remote execution
configuration management and much more

28
00:01:37,729 --> 00:01:41,280
on so kinda some buzz word bingo they're
and

29
00:01:41,280 --> 00:01:44,780
a lot of things going on so so let's
break it down on

30
00:01:44,780 --> 00:01:49,540
salts act is configuration management
other configuration management tools you

31
00:01:49,540 --> 00:01:50,270
may have heard a

32
00:01:50,270 --> 00:01:54,360
CF engine was one of the early ones
there's shop and pop it like many have

33
00:01:54,360 --> 00:01:54,610
you

34
00:01:54,600 --> 00:01:58,240
views answerable is out there as well
another

35
00:01:58,240 --> 00:02:02,820
pipe an option so before configuration
management

36
00:02:02,820 --> 00:02:06,560
we would set up a server with setup and
attacks on the server and we'd

37
00:02:06,560 --> 00:02:10,259
configure internet access on the
internet stock comp file on

38
00:02:10,259 --> 00:02:13,650
then we want to make a change to engine
x-com and we back it up

39
00:02:13,650 --> 00:02:17,620
and then we would do it again and again

40
00:02:17,620 --> 00:02:20,750
and I'm we just need to stop doing that

41
00:02:20,750 --> 00:02:26,510
yeah so I am after configuration
management it looks like this

42
00:02:26,510 --> 00:02:31,690
configuration management lets you have a
single set up files

43
00:02:31,690 --> 00:02:35,320
that tell you exactly what your server
is doing how is configured

44
00:02:35,320 --> 00:02:38,900
when people make changes you get nice

45
00:02:38,900 --> 00:02:42,260
log so you can put in version control on

46
00:02:42,260 --> 00:02:45,549
all these nice things to you you
basically version control your servers

47
00:02:45,549 --> 00:02:49,139
itself documenting when somebody wants
to know if the servers doing they can

48
00:02:49,139 --> 00:02:49,810
review

49
00:02:49,810 --> 00:02:53,590
your configuration management system and
see that its

50
00:02:53,590 --> 00:02:57,120
as easy to set up one server as it is a
hundred servers so

51
00:02:57,120 --> 00:03:03,010
repeatable and reusable Thompson except
salt fact is remote execution

52
00:03:03,010 --> 00:03:07,380
remote execution is kinda the
territorial fabric

53
00:03:07,380 --> 00:03:12,269
capistrano funk basically the ability to
run one or more commands

54
00:03:12,269 --> 00:03:16,109
against one or more remote systems this
is

55
00:03:16,109 --> 00:03:19,579
sorta vow to the scopa watch of
unpopular

56
00:03:19,579 --> 00:03:23,010
designed to do some examples a

57
00:03:23,010 --> 00:03:26,350
one you want to use remote execution
deploying your code

58
00:03:26,350 --> 00:03:29,699
running all all the things necessary to
do a deploy

59
00:03:29,699 --> 00:03:33,930
running one of scripts during critical
packet updates so

60
00:03:33,930 --> 00:03:37,199
open SSL harpley issue is a great
example

61
00:03:37,199 --> 00:03:41,070
when you might wanna run a specific
command one time against many systems

62
00:03:41,070 --> 00:03:44,260
a n you can use the process to
monitoring as well so

63
00:03:44,260 --> 00:03:47,540
you know checked the load on the server
every five minutes

64
00:03:47,540 --> 00:03:52,769
or the startup servers and report back
so

65
00:03:52,769 --> 00:03:55,880
that's what salt stock is are a subset
at least

66
00:03:55,880 --> 00:03:59,810
and will cover today on why would you
want to salt stock

67
00:03:59,810 --> 00:04:03,590
big thing for me I'm a Python developer

68
00:04:03,590 --> 00:04:07,109
typically work build website and Django
so

69
00:04:07,109 --> 00:04:11,190
salt sex written in Python it's
configured with the animal

70
00:04:11,190 --> 00:04:14,739
which is a a dead simple kinda
configuration language

71
00:04:14,739 --> 00:04:17,790
and it uses ginger to you as a
templating engine so

72
00:04:17,790 --> 00:04:22,040
coming from to the Django world Jan 22
template for very familiar to me

73
00:04:22,040 --> 00:04:26,580
it's all familiar tools easy for me to
hack on in contrast

74
00:04:26,580 --> 00:04:29,940
tools like shopping puppet use their own
custom DSL

75
00:04:29,940 --> 00:04:34,360
there sir based off Ruby on that wasn't
very comfortable for me so

76
00:04:34,360 --> 00:04:38,910
those are things I liked about Sol
another thing I like

77
00:04:38,910 --> 00:04:42,060
it's got really good documentation if
you want to print it out on their

78
00:04:42,060 --> 00:04:43,830
website at: over 800 pages

79
00:04:43,830 --> 00:04:48,470
they're insanely response that their
their IRC room is always poor people

80
00:04:48,470 --> 00:04:52,699
if you file an issue and get help don't
be surprised to get a response the same

81
00:04:52,699 --> 00:04:53,479
day

82
00:04:53,479 --> 00:04:57,750
on and and finally it it's backed by a
for-profit organization so

83
00:04:57,750 --> 00:05:01,289
there's people with a vested interest in
making sure salt is

84
00:05:01,289 --> 00:05:04,530
cutting-edge state-of-the-art and works

85
00:05:04,530 --> 00:05:08,560
they're not gonna go away your deposit
with their day job and disappear

86
00:05:08,560 --> 00:05:12,150
so all things I liked about it so

87
00:05:12,150 --> 00:05:15,180
thats that's why you might wanna juice
salt sack about

88
00:05:15,180 --> 00:05:18,280
for some reason maybe why you might not
wanna to salt stock

89
00:05:18,280 --> 00:05:21,699
a here here serves the the common things
I hear

90
00:05:21,699 --> 00:05:24,770
a about why people don't like Saul on

91
00:05:24,770 --> 00:05:28,949
at the young project it moves fast
they're they're constantly building new

92
00:05:28,949 --> 00:05:30,120
features

93
00:05:30,120 --> 00:05:34,560
that might be scary its long as they can
to maintain stability

94
00:05:34,560 --> 00:05:37,680
on that's that's a plus in my book there

95
00:05:37,680 --> 00:05:40,930
there making it better without breaking
old stuff

96
00:05:40,930 --> 00:05:44,400
and in my general experience over the
last

97
00:05:44,400 --> 00:05:47,460
probably couple years now that's the
case

98
00:05:47,460 --> 00:05:52,409
a and it doesn't use ssh as a tramper
transport and communication mechanism

99
00:05:52,409 --> 00:05:53,680
between servers

100
00:05:53,680 --> 00:05:57,610
so the as the sages tried-and-true
people trust that

101
00:05:57,610 --> 00:06:01,090
and that's great a lot of things salt

102
00:06:01,090 --> 00:06:05,870
needs to do it does over kinda been
always on communication bus between

103
00:06:05,870 --> 00:06:07,039
servers

104
00:06:07,039 --> 00:06:10,379
as a CH really on doesn't work as well
for that

105
00:06:10,379 --> 00:06:13,879
and doesn't scale to level they want to
scale there

106
00:06:13,879 --> 00:06:16,900
you know talking thousands of servers

107
00:06:16,900 --> 00:06:22,810
managed by by one master that has some
messages part in our first status right

108
00:06:22,810 --> 00:06:23,749
now

109
00:06:23,749 --> 00:06:28,090
but you don't want to use that and
production

110
00:06:28,090 --> 00:06:31,699
I'm so let's dive in and actually start
learning about Sol

111
00:06:31,699 --> 00:06:35,620
so the first thing we need to do is take
a cab vocabulary lesson

112
00:06:35,620 --> 00:06:38,979
on the state gov can adopt in general is

113
00:06:38,979 --> 00:06:42,810
is terrible with ok area where there is
no kinda widely accepted

114
00:06:42,810 --> 00:06:48,139
terminology for the stuff so shop has
sniping recipes and cookbooks and puppet

115
00:06:48,139 --> 00:06:48,550
has

116
00:06:48,550 --> 00:06:53,030
terminus and meta parameters handsome
boys play books and inventories

117
00:06:53,030 --> 00:06:56,080
on salt might be the worst offender here
there's

118
00:06:56,080 --> 00:06:59,509
lotsa terminology unita learn so

119
00:06:59,509 --> 00:07:03,539
to get started there's the master this
is the server that kinda managers

120
00:07:03,539 --> 00:07:04,479
everything

121
00:07:04,479 --> 00:07:07,650
a you know authenticating other servers

122
00:07:07,650 --> 00:07:11,409
States pillars we'll get into that in a
second

123
00:07:11,409 --> 00:07:14,669
there's a minyan a million connects to
the master

124
00:07:14,669 --> 00:07:18,620
typically you have one master server and
many minions you can have

125
00:07:18,620 --> 00:07:22,389
0 master servers minutes can manage
themselves

126
00:07:22,389 --> 00:07:25,539
and there's lots of other configurations
but in general a minyan at the server

127
00:07:25,539 --> 00:07:27,779
controlled by the master

128
00:07:27,779 --> 00:07:32,770
there's a state Minnesota State so the
state is a declarative representation up

129
00:07:32,770 --> 00:07:33,949
system state

130
00:07:33,949 --> 00:07:37,509
basically how you want your minion to be
configured so

131
00:07:37,509 --> 00:07:43,330
when you stack up all the states that's
that the configuration of your system

132
00:07:43,330 --> 00:07:47,210
there is a grain a grain is a static
piece of information

133
00:07:47,210 --> 00:07:50,629
about your minion you're basically
you're your server your configuring

134
00:07:50,629 --> 00:07:53,759
this is things that but don't change
regularly

135
00:07:53,759 --> 00:07:56,939
things like how much RAM is in the box
how many CPU that has

136
00:07:56,939 --> 00:08:00,310
what OS it's running her

137
00:08:00,310 --> 00:08:04,150
there's pillars pillars are herb is the
camping amid

138
00:08:04,150 --> 00:08:07,930
as variables so bizarre things that you
might want to change between

139
00:08:07,930 --> 00:08:11,949
different appointments maybe you have a
a development server that runs

140
00:08:11,949 --> 00:08:15,900
a one branch your code and production
server that runs another

141
00:08:15,900 --> 00:08:19,969
use pillars to manage this ports pile
powers

142
00:08:19,969 --> 00:08:23,599
things like that that change between
your system

143
00:08:23,599 --> 00:08:27,969
so kinda putting it all together on
we've got our our big master server here

144
00:08:27,969 --> 00:08:31,279
it's got a set up alerts on a an
assertive States

145
00:08:31,279 --> 00:08:35,700
that mastered connects to one or many
minions in each million brings its own

146
00:08:35,700 --> 00:08:39,340
set up Green's whether

147
00:08:39,340 --> 00:08:44,480
okay next up is the top file the top
file matches states and pillars

148
00:08:44,480 --> 00:08:48,779
to minions so in your master you
probably have configuration for lots of

149
00:08:48,779 --> 00:08:52,480
different systems may be a database
server may be an application server

150
00:08:52,480 --> 00:08:56,889
the top files what says the specific
states go to the specific servers are

151
00:08:56,889 --> 00:08:58,639
basically pulled out a subset

152
00:08:58,639 --> 00:09:02,329
and matches those and finally

153
00:09:02,329 --> 00:09:05,949
there's high state high state is that
subset States

154
00:09:05,949 --> 00:09:09,230
that belong to you a specific minion

155
00:09:09,230 --> 00:09:12,889
so adding to our diagram we now have

156
00:09:12,889 --> 00:09:16,180
pillars and states those kinda filter
through a top

157
00:09:16,180 --> 00:09:20,529
file on the minion hand it's grains to
the

158
00:09:20,529 --> 00:09:25,230
to the master that are cash their some
magic happens at all smashes together

159
00:09:25,230 --> 00:09:28,440
and your configuration lives on your
minion

160
00:09:28,440 --> 00:09:31,440
its it's really not to magical it's just
Python

161
00:09:31,440 --> 00:09:36,949
but just getting started with salt so it
mattered for now

162
00:09:36,949 --> 00:09:40,260
okay so let's really get started on
insulation

163
00:09:40,260 --> 00:09:44,839
the really easy there's binaries
available for most distributions

164
00:09:44,839 --> 00:09:48,410
you can pip install it if you wanna the
bleeding edge

165
00:09:48,410 --> 00:09:52,000
or if you wanted hack on it in part on
yourself

166
00:09:52,000 --> 00:09:55,800
there is a script available at bootstrap
got salt stock .org

167
00:09:55,800 --> 00:09:59,389
it probably does what you want which is
to

168
00:09:59,389 --> 00:10:02,820
reach out to you repose that salt
managers and

169
00:10:02,820 --> 00:10:07,910
install binaries from there you did
usually don't wanna install from your

170
00:10:07,910 --> 00:10:10,920
operating systems repose because

171
00:10:10,920 --> 00:10:15,829
their probably old and mica said the
project minutes past

172
00:10:15,829 --> 00:10:19,750
so what's the this is an example with
Ubuntu

173
00:10:19,750 --> 00:10:22,829
a I'm gonna go ahead and let's say we've
installed the

174
00:10:22,829 --> 00:10:27,220
South package archive their pee PA to
get the master running I would run

175
00:10:27,220 --> 00:10:31,310
apt-get install salt master we can also
run it master list which are shown in a

176
00:10:31,310 --> 00:10:33,610
second

177
00:10:33,610 --> 00:10:37,839
next up we're gonna set up a minyan so
apt-get install salt minion

178
00:10:37,839 --> 00:10:41,190
and then we need to tell that minion
where

179
00:10:41,190 --> 00:10:46,320
its master lives so but a fall it's
gonna look for server called salt

180
00:10:46,320 --> 00:10:50,550
so we can drop the the IP address in
your hosts file

181
00:10:50,550 --> 00:10:53,550
alternatively some there's this
configuration file

182
00:10:53,550 --> 00:10:58,269
at at sea slash salt slash mass births
are such minion

183
00:10:58,269 --> 00:11:02,899
and you can put in whatever hostname
their your master lives on

184
00:11:02,899 --> 00:11:06,910
so a when that when you do that the
minions going to reach out to the master

185
00:11:06,910 --> 00:11:08,279
and say hey

186
00:11:08,279 --> 00:11:11,709
here's my the authentication key let me
a

187
00:11:11,709 --> 00:11:16,750
access you know over on the state's the
Masters gonna say I don't recognize you

188
00:11:16,750 --> 00:11:21,240
I've never seen the server for and put
it into a set of pending servers that

189
00:11:21,240 --> 00:11:21,850
have now

190
00:11:21,850 --> 00:11:25,759
authenticated with the master we can go
to the master now

191
00:11:25,759 --> 00:11:30,160
salt pesky dash a has except and except

192
00:11:30,160 --> 00:11:34,019
the this many in connecting you can also
list although

193
00:11:34,019 --> 00:11:38,540
the keys waiting and you can verify them
with their fingerprints to make sure

194
00:11:38,540 --> 00:11:41,190
that actually is the server you think it
is

195
00:11:41,190 --> 00:11:46,220
an but will discuss short circuit that
for now and go ahead and accept that

196
00:11:46,220 --> 00:11:49,259
so a let's writer for state

197
00:11:49,259 --> 00:11:52,410
on missus this is probably the simplest
eight we can run

198
00:11:52,410 --> 00:11:55,820
it lives in slash SRB slash salt

199
00:11:55,820 --> 00:11:59,519
that's kinda salts default directory for
all its

200
00:11:59,519 --> 00:12:03,370
States and it's called my state dot as a
last-start

201
00:12:03,370 --> 00:12:06,920
SOS is the file extension that's all
users

202
00:12:06,920 --> 00:12:09,949
on package dot installed is the state

203
00:12:09,949 --> 00:12:14,120
we're gonna call and we're gonna call it
for and relax here so what this is going

204
00:12:14,120 --> 00:12:16,610
to do is install in Jax

205
00:12:16,610 --> 00:12:21,100
on our system so that the state file

206
00:12:21,100 --> 00:12:24,420
next we need to create the top piled
atop piles that thing that matters

207
00:12:24,420 --> 00:12:25,139
States

208
00:12:25,139 --> 00:12:29,000
to minions so that also lives in

209
00:12:29,000 --> 00:12:32,660
five serves much salt it's called topped
out as a last Sat though is called

210
00:12:32,660 --> 00:12:34,079
topped out at the last

211
00:12:34,079 --> 00:12:38,449
a yeah it and this is the environment
base here

212
00:12:38,449 --> 00:12:41,279
we're not going to deal with
environments today so just we're always

213
00:12:41,279 --> 00:12:42,829
going to use base

214
00:12:42,829 --> 00:12:46,779
my server is the name of the server were
expecting to connect

215
00:12:46,779 --> 00:12:49,819
and my state is the file name: love

216
00:12:49,819 --> 00:12:53,910
the State recruit her my state that I
sell us

217
00:12:53,910 --> 00:12:58,329
so this does whenever my server texan
send it might stay

218
00:12:58,329 --> 00:13:02,250
an hour gonna high state so a few
different ways to do this

219
00:13:02,250 --> 00:13:06,740
because assault has a kinda annoys on
communication bus

220
00:13:06,740 --> 00:13:10,440
we can push it down from the master
looks like salt

221
00:13:10,440 --> 00:13:14,069
the name of the server you wanna push to
and state that high state

222
00:13:14,069 --> 00:13:17,100
that's the model we want to run

223
00:13:17,100 --> 00:13:20,170
we can put from the minion so that's
salt ash call

224
00:13:20,170 --> 00:13:24,699
state that high stay and then you can
actually run master list so if we didn't

225
00:13:24,699 --> 00:13:26,100
have a master server

226
00:13:26,100 --> 00:13:30,149
and the those files we created were
living on the minion

227
00:13:30,149 --> 00:13:33,610
we could just run with this dash dash
local flag

228
00:13:33,610 --> 00:13:40,610
and that is going to portrait of the
local filesystem

229
00:13:41,930 --> 00:13:46,240
next up you're going to get a wall taxed
that's gonna do all sorts of stuff like

230
00:13:46,240 --> 00:13:49,279
to install and relax on your system

231
00:13:49,279 --> 00:13:53,630
its gonna install these packages that
engine X depends on to run

232
00:13:53,630 --> 00:13:57,440
and it's going to tell you at the very
end

233
00:13:57,440 --> 00:14:01,750
wait out the bottom here you get this
green line 1 succeeded nets are we ran

234
00:14:01,750 --> 00:14:02,500
one state

235
00:14:02,500 --> 00:14:06,670
it succeeded success we've done it

236
00:14:06,670 --> 00:14:09,949
so just review again created its

237
00:14:09,949 --> 00:14:14,120
safe I'll we created a top pile and we
told the minion

238
00:14:14,120 --> 00:14:18,449
to check in and get it I stay and we
kinda ran through the bottom section

239
00:14:18,449 --> 00:14:19,519
about

240
00:14:19,519 --> 00:14:23,899
picture so at a really basic state
example

241
00:14:23,899 --> 00:14:26,910
let's do something a little more advance
a

242
00:14:26,910 --> 00:14:31,160
chairman to create a user on the system
you can kind of think it states like

243
00:14:31,160 --> 00:14:32,279
Python functions

244
00:14:32,279 --> 00:14:35,649
they take they can take keyword
arguments so

245
00:14:35,649 --> 00:14:39,980
user to present as the state we're gonna
call the name in the state is P

246
00:14:39,980 --> 00:14:43,329
so that's going to create a user copy on
my system

247
00:14:43,329 --> 00:14:48,769
I'm gonna give it a a shell and a home
directory and all that good stuff

248
00:14:48,769 --> 00:14:51,800
I can stack state up so

249
00:14:51,800 --> 00:14:54,959
hereof gonna use it up present state at
the top

250
00:14:54,959 --> 00:14:57,959
and below I'm gonna said an SSH

251
00:14:57,959 --> 00:15:02,970
key for myself on it so as a state of
dot present as my second state

252
00:15:02,970 --> 00:15:06,949
and I'm gonna run it for the user p and
a

253
00:15:06,949 --> 00:15:10,399
I've got sourcing require so those kinda

254
00:15:10,399 --> 00:15:14,350
probably require a little explanation so
on

255
00:15:14,350 --> 00:15:17,470
in that has slashed SRV slash salt
directory

256
00:15:17,470 --> 00:15:21,050
you can basically sir files out at that
and push those down your minions

257
00:15:21,050 --> 00:15:24,730
so in this example I would have a file
called pitot pub

258
00:15:24,730 --> 00:15:29,310
that would have my public key in it and
I would put it and slash serve slash

259
00:15:29,310 --> 00:15:29,990
salt

260
00:15:29,990 --> 00:15:33,230
and that could push it right down for
that user

261
00:15:33,230 --> 00:15:38,720
as a accept a key on and then I have
this requires him in here

262
00:15:38,720 --> 00:15:41,899
that that says that the associate of
requires that

263
00:15:41,899 --> 00:15:46,420
the user state named p which are defined
right above

264
00:15:46,420 --> 00:15:49,480
it needs to run for this to run the

265
00:15:49,480 --> 00:15:52,730
the requires art totally necessary
anymore on

266
00:15:52,730 --> 00:15:55,959
salt runs state's top to bottom so

267
00:15:55,959 --> 00:16:00,060
I can be pretty guarantee that the user
to present is gonna run before the SSH

268
00:16:00,060 --> 00:16:05,269
of dot president but this makes that
relationship explicit

269
00:16:05,269 --> 00:16:08,589
and when you have when you're debugging
are you have airs

270
00:16:08,589 --> 00:16:12,930
on that's really nice so rather than
having all your heirs kinda pile up and

271
00:16:12,930 --> 00:16:15,379
having to sift through to figure out
what cause

272
00:16:15,379 --> 00:16:19,620
what problem my my if my first state
fails

273
00:16:19,620 --> 00:16:22,800
my second one is gonna say a state I
depend on

274
00:16:22,800 --> 00:16:27,209
prerequisite failed and I didn't run so
it makes it really easy to find the root

275
00:16:27,209 --> 00:16:28,980
cause a problem so

276
00:16:28,980 --> 00:16:32,889
even the required isn't totally
necessary recommended just keep things

277
00:16:32,889 --> 00:16:33,990
explicit

278
00:16:33,990 --> 00:16:37,519
we like that pic on it

279
00:16:37,519 --> 00:16:42,550
on here's another example the state get
out latest as the state I'm calling

280
00:16:42,550 --> 00:16:46,569
checking out a get repo from get her I A
can get better

281
00:16:46,569 --> 00:16:51,850
revision Anna place the directory on to
land on my filesystem Intel it but

282
00:16:51,850 --> 00:16:56,600
the package no get needs to be installed
in order to run this

283
00:16:56,600 --> 00:17:00,250
I can also run arbitrary command so
command outrun

284
00:17:00,250 --> 00:17:04,410
is is another state I can call in this
example I've gotta

285
00:17:04,410 --> 00:17:07,829
they've got a Django site now I want to
thank the database so

286
00:17:07,829 --> 00:17:11,180
bypass and the name I told where to run
and

287
00:17:11,180 --> 00:17:15,589
I need to make sure my my softwares is
on the server as well

288
00:17:15,589 --> 00:17:18,630
so and tons ways you can kinda makes
these up

289
00:17:18,630 --> 00:17:22,170
and set up your servers there's over 50
built in states

290
00:17:22,170 --> 00:17:25,870
date they do pretty much everything you
need to do its it's very rare that you

291
00:17:25,870 --> 00:17:26,660
need to

292
00:17:26,660 --> 00:17:29,670
build your own state or module to

293
00:17:29,670 --> 00:17:33,060
to set up a server so for Python people

294
00:17:33,060 --> 00:17:37,050
pippin virtual number there you can
manage databases database users

295
00:17:37,050 --> 00:17:41,400
you can bring services up and down you
can put files on your server

296
00:17:41,400 --> 00:17:46,720
you can add crime jobs or you can write
your own it's just papon

297
00:17:46,720 --> 00:17:50,650
so a next up is pillars so if you
remember

298
00:17:50,650 --> 00:17:54,330
pillars are basically variables and in
this whole system

299
00:17:54,330 --> 00:17:57,340
made available for part one or more
minions

300
00:17:57,340 --> 00:18:01,310
so let's create our first pillar are
pillars live in Flash

301
00:18:01,310 --> 00:18:04,820
a service last pillar that's the default
location just like slash

302
00:18:04,820 --> 00:18:08,550
SRV slash salt as the default location
for states

303
00:18:08,550 --> 00:18:13,540
you can change those but if you put in
there everything just works

304
00:18:13,540 --> 00:18:16,620
so we're gonna create a pillar called
might say and

305
00:18:16,620 --> 00:18:19,850
it's got this value in it key value
branch

306
00:18:19,850 --> 00:18:23,540
develop so just like

307
00:18:23,540 --> 00:18:26,650
on our States we're gonna create a top
I'll

308
00:18:26,650 --> 00:18:30,010
serve pillar topped out a SOLAS the

309
00:18:30,010 --> 00:18:34,150
the base environment and then we put the
server that it applies to you

310
00:18:34,150 --> 00:18:37,210
and the name up the pillar so

311
00:18:37,210 --> 00:18:40,700
again week we called it my site doesn't
need to be

312
00:18:40,700 --> 00:18:44,570
the same name as their state i'd it's
just an example so

313
00:18:44,570 --> 00:18:48,280
my site as a last will match that

314
00:18:48,280 --> 00:18:51,280
on you can get fancy with top files to
you

315
00:18:51,280 --> 00:18:56,030
so so this is home you know some some
kinda comments up you'll see

316
00:18:56,030 --> 00:18:59,970
star will match anything so if you have
a default you maybe want to

317
00:18:59,970 --> 00:19:03,800
put all your users your company that
they can log into the server so you

318
00:19:03,800 --> 00:19:06,680
could put that into their and I will
match all the servers

319
00:19:06,680 --> 00:19:11,480
on you can use clubbing so obviously
start out something in

320
00:19:11,480 --> 00:19:14,960
match you know maybe all your app
servers or something like that

321
00:19:14,960 --> 00:19:18,070
you can match on grains so I can say a
thus

322
00:19:18,070 --> 00:19:21,550
this applies to all my Ubuntu servers if
maybe you've got some

323
00:19:21,550 --> 00:19:26,300
Ubuntu and Windows stuff in your
infrastructure you can use reg X

324
00:19:26,300 --> 00:19:30,160
regular expression regular expressions
Mike and/or

325
00:19:30,160 --> 00:19:33,830
compound statement so you can get really
fancy with this

326
00:19:33,830 --> 00:19:38,410
this applies to you pillar top filed it
also applies to state top filed

327
00:19:38,410 --> 00:19:42,310
it also applies to the way we ran it
from the command line so

328
00:19:42,310 --> 00:19:45,410
we just show an example when we did high
state of

329
00:19:45,410 --> 00:19:48,730
up a single server but you can match

330
00:19:48,730 --> 00:19:51,920
multiple servers with one command so

331
00:19:51,920 --> 00:19:56,330
a will take let's go back and take a

332
00:19:56,330 --> 00:20:00,150
here's our pillar we created my say
branch develop and

333
00:20:00,150 --> 00:20:05,220
we're gonna apply that to a state so his
example we've got our application

334
00:20:05,220 --> 00:20:08,390
and we wanna a pyre develop branch to

335
00:20:08,390 --> 00:20:11,800
one server and our production branch to
another server

336
00:20:11,800 --> 00:20:15,580
we can use a pillar to modifier state so
we can

337
00:20:15,580 --> 00:20:19,100
you reuse the same state and when those

338
00:20:19,100 --> 00:20:22,560
on all those things merge the right
thing happens on the right

339
00:20:22,560 --> 00:20:26,420
server minion a

340
00:20:26,420 --> 00:20:30,980
it's ginger so you can use some papon
constructs inside here

341
00:20:30,980 --> 00:20:35,190
so in this example I'm gonna check the
my site

342
00:20:35,190 --> 00:20:39,280
dictionary which is what it ends up
being and if branch

343
00:20:39,280 --> 00:20:42,460
exists in there I'll use that value or
not

344
00:20:42,460 --> 00:20:46,120
I'm gonna use the value master as the
fall

345
00:20:46,120 --> 00:20:50,640
so you can do all sorts of crazy stuff
with ginger inside these

346
00:20:50,640 --> 00:20:54,620
if you want to

347
00:20:54,620 --> 00:20:57,730
you can use grains and pillars you can
use them in states you can use them in

348
00:20:57,730 --> 00:20:58,540
files

349
00:20:58,540 --> 00:21:01,870
a this is what using a green looks like
so

350
00:21:01,870 --> 00:21:05,220
in this example I'm a setup a pillar in

351
00:21:05,220 --> 00:21:08,850
I'm gonna for the pillar name red is max
memory

352
00:21:08,850 --> 00:21:13,570
and there's 'em a grain called man total
that's all the memory in my system in

353
00:21:13,570 --> 00:21:14,300
megabytes

354
00:21:14,300 --> 00:21:17,700
and I'm gonna say use happen that memory

355
00:21:17,700 --> 00:21:21,220
for the Spiller rose max memory so if I
had

356
00:21:21,220 --> 00:21:24,280
512 megabytes in the system this is
gonna

357
00:21:24,280 --> 00:21:28,440
output 256 Mb

358
00:21:28,440 --> 00:21:32,170
now I could write a state and in my
state I

359
00:21:32,170 --> 00:21:36,200
to I'm gonna some I read this dot com
file

360
00:21:36,200 --> 00:21:40,010
and I'm gonna tell it that it is agenda
template

361
00:21:40,010 --> 00:21:43,370
there's other template language is
available if you want to and I tell

362
00:21:43,370 --> 00:21:44,480
where the sources

363
00:21:44,480 --> 00:21:49,130
thus also lives in that slash SRV slash
salt directory

364
00:21:49,130 --> 00:21:52,690
read a stock car that gingers the name
of the file and a Passover Seder

365
00:21:52,690 --> 00:21:55,850
defaults those are basically variables
that are going to get used when this

366
00:21:55,850 --> 00:21:57,890
file gets rendered out to

367
00:21:57,890 --> 00:22:02,670
the server so that templates gonna look
like this

368
00:22:02,670 --> 00:22:07,560
its not going to work as we britain at
but when it gets dumped onto

369
00:22:07,560 --> 00:22:11,930
with the minyan the votes gonna run that
max memory variable is going to be

370
00:22:11,930 --> 00:22:13,020
replaced

371
00:22:13,020 --> 00:22:16,660
with the value redefined in our

372
00:22:16,660 --> 00:22:20,140
killer here so you can get

373
00:22:20,140 --> 00:22:24,520
really dynamic with a view cam apply the
stuff really anywhere in the system

374
00:22:24,520 --> 00:22:28,500
inside pillars in tight state inside
files

375
00:22:28,500 --> 00:22:31,790
yeah so so that is kinda the the basics

376
00:22:31,790 --> 00:22:35,740
assault a and setting up a server

377
00:22:35,740 --> 00:22:39,900
there are it's like the tiniest little
subset what

378
00:22:39,900 --> 00:22:43,550
thought can do but thats getting started
with salt on

379
00:22:43,550 --> 00:22:47,180
other things that are interesting in
salt aerosol cloud

380
00:22:47,180 --> 00:22:50,330
so-called lets you bring up and down

381
00:22:50,330 --> 00:22:54,540
cloud servers and a.w.s or Rackspace or

382
00:22:54,540 --> 00:22:57,640
line odor digital oceana cut although

383
00:22:57,640 --> 00:23:01,490
providers all the popular providers are
in there so really awesome

384
00:23:01,490 --> 00:23:06,080
for on you maybe wanna test you can test
your configurations

385
00:23:06,080 --> 00:23:09,330
you know spin up a server run it

386
00:23:09,330 --> 00:23:12,680
you know do a continuous integration and
Jenkins make sure

387
00:23:12,680 --> 00:23:15,560
it's configured properly and you can
access your web site and tear it all

388
00:23:15,560 --> 00:23:17,210
down when you're done and pay for

389
00:23:17,210 --> 00:23:21,840
five minutes of usage a you can build
custom modules so

390
00:23:21,840 --> 00:23:25,110
modules are and the things that back
like

391
00:23:25,110 --> 00:23:30,020
commando run that we saw our get out
latest you can do those in Python

392
00:23:30,020 --> 00:23:34,080
so I've written some custom modules that
will

393
00:23:34,080 --> 00:23:37,320
probe for status on uncertain system so

394
00:23:37,320 --> 00:23:42,810
check my engine axe status how many
active connections does it have

395
00:23:42,810 --> 00:23:48,460
probe and memcached status and push that
somewhere

396
00:23:48,460 --> 00:23:51,950
the scheduler is pretty great its

397
00:23:51,950 --> 00:23:55,530
like Ron but probably easier to use I
think

398
00:23:55,530 --> 00:23:59,330
and so you can schedule a certain task
to run and

399
00:23:59,330 --> 00:24:03,210
also configure what happens to the
output up that so

400
00:24:03,210 --> 00:24:06,670
this works really well for unlike system
honoring

401
00:24:06,670 --> 00:24:10,240
I can say you checked the load on the
system and San

402
00:24:10,240 --> 00:24:14,500
send that info to graphite when I'm done

403
00:24:14,500 --> 00:24:18,310
there's custom renders so when I showed
you today is is %um all

404
00:24:18,310 --> 00:24:22,890
and ginger but you can use other things
you can actually configured in pure

405
00:24:22,890 --> 00:24:23,630
Python

406
00:24:23,630 --> 00:24:27,430
just just writing partial Python you can

407
00:24:27,430 --> 00:24:31,200
it has its own pipeline DSL if you
thought but the S l's and

408
00:24:31,200 --> 00:24:34,800
shopping reviewer up in public where a
good idea on

409
00:24:34,800 --> 00:24:39,510
and maco has custom returners so

410
00:24:39,510 --> 00:24:43,940
when we ran the the state's the first
time if returned to the console in

411
00:24:43,940 --> 00:24:45,480
dispute all that textile

412
00:24:45,480 --> 00:24:49,450
week instead could configure it to you
returned to

413
00:24:49,450 --> 00:24:52,890
an email address so whenever anybody
runs high state I wanna

414
00:24:52,890 --> 00:24:56,210
you get an email to ops address to know

415
00:24:56,210 --> 00:25:00,250
on you can return to graphite you can
return

416
00:25:00,250 --> 00:25:03,610
to century you can return to thirst log

417
00:25:03,610 --> 00:25:07,370
so lots of different ways you can kinda
handle the output

418
00:25:07,370 --> 00:25:10,560
a you're SOL commands and then

419
00:25:10,560 --> 00:25:15,010
finally the reactor this is something
that i think is kinda unique to

420
00:25:15,010 --> 00:25:18,840
saw it's got this always on
communication bus between all your

421
00:25:18,840 --> 00:25:19,720
servers

422
00:25:19,720 --> 00:25:22,900
and anything anytime salt is doing
something in your system

423
00:25:22,900 --> 00:25:26,580
it's firing offense over that
communication bus you can

424
00:25:26,580 --> 00:25:30,380
basically plug into it and listen to
those amounts and react to them

425
00:25:30,380 --> 00:25:33,410
and do other things so you could say

426
00:25:33,410 --> 00:25:37,630
every time I run a high state I want to
notify

427
00:25:37,630 --> 00:25:40,750
New Relic that a new deploy happened

428
00:25:40,750 --> 00:25:44,690
you know mark that in my history so I
can see that my grass

429
00:25:44,690 --> 00:25:49,650
you can do that in %um all directly or
you can actually write Python scripts

430
00:25:49,650 --> 00:25:52,910
custom Python scripts that will listened
and

431
00:25:52,910 --> 00:25:57,970
do stuff based on what's happening over
that bus

432
00:25:57,970 --> 00:26:01,080
a few tips and tricks

433
00:26:01,080 --> 00:26:05,160
1 the DePaul output as you saw it is
really for both

434
00:26:05,160 --> 00:26:09,020
I like to go into the minion
configuration file in Chains output mode

435
00:26:09,020 --> 00:26:09,980
to mixed

436
00:26:09,980 --> 00:26:15,010
that will show all your success
statements as just one single line

437
00:26:15,010 --> 00:26:19,050
anything that fails you get the full
output on so it easier fine

438
00:26:19,050 --> 00:26:23,400
problems on to ginger too is a

439
00:26:23,400 --> 00:26:26,880
seriously powerful template language
don't go crazy with it

440
00:26:26,880 --> 00:26:31,770
a.m. like I said what are the benefits
love configuration management is that

441
00:26:31,770 --> 00:26:36,100
you can look at the configuration files
and understand what's happening and

442
00:26:36,100 --> 00:26:38,450
understand what your servers are doing

443
00:26:38,450 --> 00:26:43,620
if you go crazy with logic all over your
templates earlier configuration files

444
00:26:43,620 --> 00:26:46,800
on you're not going to be able to reason
what they're doing

445
00:26:46,800 --> 00:26:50,070
very easily in and you don't want to
have to debug

446
00:26:50,070 --> 00:26:54,370
when you're dealing with important
things like your servers

447
00:26:54,370 --> 00:26:57,610
the update often the

448
00:26:57,610 --> 00:27:02,060
do release is pretty quickly in review
the change log it's not often that they

449
00:27:02,060 --> 00:27:04,600
have backwards compatibility stuff

450
00:27:04,600 --> 00:27:08,200
but I'm usually reviewing the change log
for kinda what do you call a few

451
00:27:08,200 --> 00:27:13,440
features I can use that make the system
better for me

452
00:27:13,440 --> 00:27:17,770
and then finally as far as testing
before you deploy bigger and darker

453
00:27:17,770 --> 00:27:22,750
are great tools here you can actually
run your full so the salt States

454
00:27:22,750 --> 00:27:26,770
in the bigger machine on your on your
desktop or laptop

455
00:27:26,770 --> 00:27:29,950
you can run in da kar so kinda make sure

456
00:27:29,950 --> 00:27:32,980
to sanity checks before you push those
out production

457
00:27:32,980 --> 00:27:36,960
there's actually a project called salty
vagrant which will

458
00:27:36,960 --> 00:27:40,790
help with that as well

459
00:27:40,790 --> 00:27:44,540
so a that I have thank you very much for
coming

460
00:27:44,540 --> 00:27:48,560
and I'm here for questions and I've got
a booth with

461
00:27:48,560 --> 00:27:51,790
a company like a loop at the booth 615

462
00:27:51,790 --> 00:27:55,270
down in the expo hall so if you don't
catch me here

463
00:27:55,270 --> 00:27:58,700
feel free to stop by there and I love to
talk about the stuff for

464
00:27:58,700 --> 00:28:05,700
thank you

465
00:28:26,020 --> 00:28:28,340
it's hard to see the mic from here on

466
00:28:28,340 --> 00:28:31,470
yes we have a question hi the to see you

467
00:28:31,470 --> 00:28:34,590
were applying for a lot of customers

468
00:28:34,590 --> 00:28:38,429
on and you didn't really want them to
see

469
00:28:38,429 --> 00:28:42,570
the contents a your salt configuration
files

470
00:28:42,570 --> 00:28:45,580
because those contains a intellectual
property

471
00:28:45,580 --> 00:28:48,870
my show them how could you obfuscate
those on those hosts

472
00:28:48,870 --> 00:28:52,370
when the customers say don't have route
but they do have user access they can

473
00:28:52,370 --> 00:28:55,280
ssh in stuff like that haha

474
00:28:55,280 --> 00:28:58,440
on well all

475
00:28:58,440 --> 00:29:02,860
you could set up the you you can set up
multiple masters

476
00:29:02,860 --> 00:29:06,210
a which might be an option so maybe you
have a master for

477
00:29:06,210 --> 00:29:10,230
each a customer on the

478
00:29:10,230 --> 00:29:15,860
the the I don't know the default
permissions the cash

479
00:29:15,860 --> 00:29:19,360
the that that we're all the state files
are get cash but I don't

480
00:29:19,360 --> 00:29:22,900
if I remember correctly its it's not
going to push

481
00:29:22,900 --> 00:29:26,300
all your state files down to the minion
just the ones that applied to that

482
00:29:26,300 --> 00:29:26,980
minion

483
00:29:26,980 --> 00:29:30,660
and it may be possible that they didn't
have root you could make them so they

484
00:29:30,660 --> 00:29:31,670
weren't readable

485
00:29:31,670 --> 00:29:38,670
the by by that user cool thanks up

486
00:29:38,940 --> 00:29:43,860
the problem had with us all TV current
now on when I tried actually used for

487
00:29:43,860 --> 00:29:48,429
testing is that vagrant isn't happy
assigning specific network addresses

488
00:29:48,429 --> 00:29:52,429
yes when you spin at multiple vagrants
yes on which means they can't find the

489
00:29:52,429 --> 00:29:53,179
salt server

490
00:29:53,179 --> 00:29:56,750
is there some kind an easy fix for that
a

491
00:29:56,750 --> 00:30:01,440
okay so why when I views that I've just
done it for single server sir single

492
00:30:01,440 --> 00:30:06,230
set up server setup so I haven't had an
issue with that finding

493
00:30:06,230 --> 00:30:09,540
the the salt server because I'm
basically pushing

494
00:30:09,540 --> 00:30:13,410
the state's down in running at Mass true
master was basically a

495
00:30:13,410 --> 00:30:16,750
other other states gone to that bigger
box on on

496
00:30:16,750 --> 00:30:20,380
spin up as far as running

497
00:30:20,380 --> 00:30:24,790
yeah I'm I'm not sure how you would do a
multi set up

498
00:30:24,790 --> 00:30:27,850
there's some interesting stuff

499
00:30:27,850 --> 00:30:31,580
the there's a something called salt mine
which lets

500
00:30:31,580 --> 00:30:35,110
millions talk to minions I think so

501
00:30:35,110 --> 00:30:38,690
maybe it's possible that you could kind
of query for where the master is

502
00:30:38,690 --> 00:30:40,010
dynamically and

503
00:30:40,010 --> 00:30:43,559
set something up the

504
00:30:43,559 --> 00:30:48,520
yeah not I'm not quite sure but yet like
I said most most the time doing it for a

505
00:30:48,520 --> 00:30:49,320
single box

506
00:30:49,320 --> 00:30:52,340
and it works were just Masroor set up
but

507
00:30:52,340 --> 00:30:59,340
not sure how you dynamically do that
otherwise ok

508
00:31:09,240 --> 00:31:15,770
oca so your other what's the name of the
product bossman eight er

509
00:31:15,770 --> 00:31:20,360
host man eight er okay so yet maybe
there's possibility to

510
00:31:20,360 --> 00:31:23,820
inject info on your hosts file and make
that work

511
00:31:23,820 --> 00:31:26,860
I

512
00:31:26,860 --> 00:31:30,290
I have a question I know that salt
implemented its own crypto

513
00:31:30,290 --> 00:31:33,390
could you please going to the reasons
behind that

514
00:31:33,390 --> 00:31:37,160
and wide is a good thing her and I is

515
00:31:37,160 --> 00:31:40,650
I'm not a assault developer I work with
salt

516
00:31:40,650 --> 00:31:44,500
I am a I I

517
00:31:44,500 --> 00:31:48,800
you think that's the holdover I think
their pretty aware that

518
00:31:48,800 --> 00:31:52,550
maybe there are better options there

519
00:31:52,550 --> 00:31:55,670
on and just haven't gotten to it a

520
00:31:55,670 --> 00:32:00,640
I think on if

521
00:32:00,640 --> 00:32:03,680
if if you're very concerned about the
crypto there are other options

522
00:32:03,680 --> 00:32:07,910
you can them you know basically firewall
stuff

523
00:32:07,910 --> 00:32:11,210
you can make sure your minions can only
talk to

524
00:32:11,210 --> 00:32:14,590
you know the master over that poor and
maybe just

525
00:32:14,590 --> 00:32:18,810
trusted as you know encryption on so
yeah I I think

526
00:32:18,810 --> 00:32:22,180
the the only reason that is in there now
there's a there's a

527
00:32:22,180 --> 00:32:26,800
long-running issue and get home about
their crypto implementation

528
00:32:26,800 --> 00:32:30,780
they're kinda two issues what that one
is its

529
00:32:30,780 --> 00:32:34,310
it's using an to crypto which is

530
00:32:34,310 --> 00:32:37,360
sorta slowly dying in the Python world

531
00:32:37,360 --> 00:32:42,010
and so they can't I think stop by
country compatible

532
00:32:42,010 --> 00:32:45,850
requires compiling so it's not your
Python on

533
00:32:45,850 --> 00:32:49,350
and then the other one is you know are
there more

534
00:32:49,350 --> 00:32:52,550
secure way is a doing it so

535
00:32:52,550 --> 00:32:55,640
I think it's a known issue it just

536
00:32:55,640 --> 00:32:59,100
is probably a a development bandwidth
issue at this point

537
00:32:59,100 --> 00:33:02,430
there there's I know they're looking at

538
00:33:02,430 --> 00:33:06,040
keys are back that Google has there's
another

539
00:33:06,040 --> 00:33:10,030
project called NaCl that

540
00:33:10,030 --> 00:33:13,170
has a little more about it crypto stuff

541
00:33:13,170 --> 00:33:17,560
so you know I don't know exactly why but
I would say it's mostly like to see

542
00:33:17,560 --> 00:33:21,960
her

543
00:33:21,960 --> 00:33:28,960
have the number questions thank you very
much better

544
00:33:30,630 --> 00:33:34,880
serb icon is a conference that relies on
volunteers and sponsors for keeping the

545
00:33:34,880 --> 00:33:37,950
and and she lo and so we really wanna
thank

546
00:33:37,950 --> 00:33:41,040
this particular sponsor go meet him in
the booth and say how much you love them

547
00:33:41,040 --> 00:33:44,540
and volunteers as well somebody asked me
like how did you get this job

548
00:33:44,540 --> 00:33:47,710
like the one I do this a way of signing
up

549
00:33:47,710 --> 00:33:51,130
before the conference starts as anybody
can do this kinda job we all volunteered

550
00:33:51,130 --> 00:33:51,950
in a

551
00:33:51,950 --> 00:33:56,270
I don't get paid for this is on and the
third one is this a break right now

552
00:33:56,270 --> 00:33:59,350
in room 220 dei so see you later

553
00:33:59,350 --> 00:33:59,600
by

